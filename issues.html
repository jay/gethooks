<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html itemscope itemtype="http://schema.org/Product">
	<head>
		<title>GetHooks known issues for Windows x86 2k/XP/Vista/7/8</title>
		<style type="text/css">
			body {
			background-color: #F8F8F8;
			font-family: arial, helvetica, sans-serif;
			}
		</style>
		
		<meta itemprop="name" content="GetHooks known issues for Windows x86 2k/XP/Vista/7/8">
		<meta itemprop="description" content="GetHooks is a program that detects and monitors SetWindowsHookEx() type hooks in Windows.">
		<meta itemprop="image" content="https://jay.github.io/gethooks/gethooks built Nov 17 2011.png">
		
		
		<!-- Google Analytics BEGIN Part1 (Part1 at bottom of head, Part2 at bottom of body) -->
		<script type="text/javascript">
		
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-27626808-1']);
		_gaq.push(['_trackPageview']);
		</script>
		<!-- Google Analytics END Part1 (Part1 at bottom of head, Part2 at bottom of body) -->
	</head>
	
	<body>
		<p>
		<h1>GetHooks known issues for Windows x86 2k/XP/Vista/7/8</h1>
		These are the known issues for gethooks v1.01 - Built on Dec 14 2011 at 00:48:09.<br>
		If you are looking for the GetHooks homepage <a href="index.html">click here.</a><br>
		<br>
		<br>
		</p>
		
		<p>
		<h3>FATAL errors on Windows 2000</h3>
		I designed GetHooks to work on Windows 2000 but it looks as though I got an offset wrong somewhere. I have to debug GetHooks in Windows 2000 but that's proving to be a real chore, and maybe even impossible using Visual Studio 2010.<br>
		<br>
		<br>
		</p>
		
		<p>
		<h3>Error: ..\desktop.c line xxx, attach(): Failed to get a pointer to the DESKTOPINFO struct.</h3>
		x64 support is not implemented. If you run GetHooks on Windows x64 it's likely it will fail. If you are running on Windows x86 and you see that error please run systeminfo and send me the output:<br>
		<span style="font-family: 'lucida console', 'courier new', courier, monospace !important">
		systeminfo | findstr &quot;^OS Locale Type&quot;<br>
		</span>
		<br>
		<br>
		</p>
		
		<p>
		<h3>The snapshot store failed to initialize. (Duplicate pvWin32ThreadInfo)</h3>
		GetHooks identifies the threads associated with a hook by matching each thread's kernel mode address with the kernel mode addresses stored in each HOOK structure. Rarely, for reasons I do not yet understand, two threads in user mode will have the same kernel mode address. This does not appear to be a bug in the program. I have witnessed this on Vista and 7 systems, and also once in a clean VM where I was running GetHooks for testing purposes.<br>
		<br>
		Regrettably I have yet to find a solution to this issue. I suspect it is caused by the kernel reusing addresses or maybe structures. Unless I find a way to identify in user mode which duplicate thread info is correct and which is &quot;stale&quot; the program cannot accurately identify the thread. For now when GetHooks encounters such a situation it will terminate to avoid reporting incorrect results. A possible workaround until I find a solution might be in such a situation to report multiple associations, but so far I'm loathe to implement that.<br>
		<br>
		Here's a screenshot of GetHooks dying on a FATAL:
		<img src="Duplicate pvWin32ThreadInfo.PNG" alt="Duplicate pvWin32ThreadInfo.PNG" /><br>
		<br>
		If you want to help me find a solution, I would like to examine the thread environment blocks (TEBs) of your user mode programs that have threads that share the same kernel mode thread address. What you can do is set in your system environment GETHOOKS_DEBUG with a value of 1. If the error above is ever encountered GetHooks should dump the TEB of any thread that has a thread kernel address that is encountered more than once.<br>
		<br>
		<br>
		</p>
		
		<p>
		<h3>UNC paths are not supported.&nbsp;&nbsp;Defaulting to Windows directory.</h3>
		GetHooks can be run from the command interpreter or directly (eg by double-clicking on it in explorer). If you do the latter GetHooks will pause before exit so the console window is not automatically closed. In this case if you are running GetHooks from a network share the command interpreter will warn you that &quot;UNC paths are not supported&quot; before pausing:<br>
		<br>
		<span style="font-family: 'lucida console', 'courier new', courier, monospace !important">
		'\\vmware-host\Shared Folders\.GetHooks24958'<br>
		CMD.EXE was started with the above path as the current directory.<br>
		UNC paths are not supported.&nbsp;&nbsp;Defaulting to Windows directory.<br>
		Press any key to continue . . .<br>
		</span>
		<br>
		You can ignore that warning.<br>
		<br>
		<br>
		</p>
		
		<p>
		<h3>Error: ..\test.c line 451, find_most_preceding_kernel_HOOK(): HOOK chain exceeded maximum supported length.</h3>
		The 'chain' test function is experimental. When you pass in a HOOK address on the command line the function must determine whether or not the HOOK is part of a chain, and where in the forwardly linked list (ie the hook chain) it is located. Then it attempts to reverse its way back up to the chain's head -- if it is not there already -- by calling find_most_preceding_kernel_HOOK(). Currently in versions 1.0 and 1.01 that function has a hard limit of max 100 HOOKs per chain.<br>
		<br>
		I recently captured a WH_MOUSE hook chain owned/originated by Google Chrome 16.0.912.63 flashplayer thread that had hundreds of HOOKs chained together. I had never seen anything get that long that works. Future versions of GetHooks will have a limit of 65535 when tracing to the head of a HOOK chain (already fixed in the develop branch Jan 2012).<br>
		<br>
		As a workaround you can run the chain function multiple times and each time it will give you an address at most 100 closer to the head. Following the example from above I check the thread and dump its hooks (logfile <a href="chrome_hook_chain/gethooks_chrome_tid5716__verbosity_0.txt">here</a>. also available in verbosity <a href="chrome_hook_chain/gethooks_chrome_tid5716__verbosity_4.txt">4</a> <a href="chrome_hook_chain/gethooks_chrome_tid5716__verbosity_6.txt">6</a> and <a href="chrome_hook_chain/gethooks_chrome_tid5716__verbosity_7.txt">7</a>.). I notice the hooks are all very similar so I pick one address at random to see how long its chain is.<br>
		<br>
		<span style="font-family: 'lucida console', 'courier new', courier, monospace !important">
		gethooks -v 4 -z chain 0xFE7E1AF0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span>
		(result: max exceeded message and says first HOOK is at 0x00000000FE6827F0)
		<br>
		<span style="font-family: 'lucida console', 'courier new', courier, monospace !important">
		gethooks -v 4 -z chain 0x00000000FE6827F0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span>
		(result: max exceeded message and says first HOOK is at 0x00000000FE659FB8)
		<br>
		<span style="font-family: 'lucida console', 'courier new', courier, monospace !important">
		gethooks -v 4 -z chain 0x00000000FE659FB8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span>
		(result: no max exceeded message and says first HOOK is at 0x00000000FE7750F0)
		<br>
		<span style="font-family: 'lucida console', 'courier new', courier, monospace !important">
		gethooks -v 4 -z chain 0x00000000FE7750F0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</span>
		(result: the full hook chain. logfile <a href="chrome_hook_chain/gethooks_chain_0x00000000FE7750F0__verbosity_0.txt">here</a>. also available in verbosity <a href="chrome_hook_chain/gethooks_chain_0x00000000FE7750F0__verbosity_4.txt">4</a> <a href="chrome_hook_chain/gethooks_chain_0x00000000FE7750F0__verbosity_6.txt">6</a> and <a href="chrome_hook_chain/gethooks_chain_0x00000000FE7750F0__verbosity_7.txt">7</a>.)
		<br>
		<br>
		<br>
		</p>
		
		<p>
		<h3>Send me any issues you encounter</h3>
		Jay Satiro &lt;raysatiro$at$yahoo{}com&gt; and put GetHooks in the subject.<br>
		<br>
		<br>
		</p>
		
		<p>
		If you are looking for the GetHooks homepage <a href="index.html">click here.</a>
		</p>
		
		
		<!-- Google Analytics BEGIN Part2 (Part1 at bottom of head, Part2 at bottom of body) -->
		<script type="text/javascript">
		(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
		</script>
		<!-- Google Analytics END Part2 (Part1 at bottom of head, Part2 at bottom of body) -->
		
		<!-- Start of StatCounter Code for Default Guide -->
		<script type="text/javascript">
		var sc_project=7480735; 
		var sc_invisible=1; 
		var sc_security="6a6701a8"; 
		</script>
		<script type="text/javascript" src="http://www.statcounter.com/counter/counter.js"></script>
		<noscript>
			<div class="statcounter">
			<a title="counter on tumblr" href="http://statcounter.com/tumblr/" target="_blank">
				<img class="statcounter" src="http://c.statcounter.com/7480735/0/6a6701a8/1/" alt="counter on tumblr">
			</a>
			</div>
		</noscript>
		<!-- End of StatCounter Code for Default Guide -->
	</body>
</html>
